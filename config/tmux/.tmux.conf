# Tmux Configuration
# Optimized for development productivity with Claude Code, VS Code, and terminal workflows

# ===== GENERAL SETTINGS =====

# Set prefix key to Ctrl-a (easier than Ctrl-b)
unbind C-b
set-option -g prefix C-a
bind-key C-a send-prefix

# Enable mouse support for modern tmux usage
set -g mouse on

# Start windows and panes at 1, not 0 (more intuitive)
set -g base-index 1
setw -g pane-base-index 1

# Renumber windows when one is closed
set -g renumber-windows on

# Increase scrollback buffer size for better history
set -g history-limit 50000

# Use 256 colors for better terminal experience
set -g default-terminal "screen-256color"
set -ga terminal-overrides ",*256col*:Tc"

# Enable focus events for vim/neovim compatibility
set -g focus-events on

# Reduce escape time for better vim experience
set -sg escape-time 0

# Increase display time for pane indicators
set -g display-panes-time 800
set -g display-time 1000

# ===== KEYBINDINGS =====

# Reload config file
bind r source-file ~/.tmux.conf \; display-message "Config reloaded!"

# Split panes using | and - (more intuitive)
bind | split-window -h -c "#{pane_current_path}"
bind - split-window -v -c "#{pane_current_path}"
unbind '"'
unbind %

# Create new window in current path
bind c new-window -c "#{pane_current_path}"

# Switch panes using Alt-arrow without prefix (for quick navigation)
bind -n M-Left select-pane -L
bind -n M-Right select-pane -R
bind -n M-Up select-pane -U
bind -n M-Down select-pane -D

# Switch windows using Shift-arrow
bind -n S-Left previous-window
bind -n S-Right next-window

# Resize panes using Ctrl-arrow
bind -n C-Left resize-pane -L 5
bind -n C-Right resize-pane -R 5
bind -n C-Up resize-pane -U 5
bind -n C-Down resize-pane -D 5

# Enable vi mode for copy mode
setw -g mode-keys vi

# Copy mode bindings (vi-style)
bind-key -T copy-mode-vi v send-keys -X begin-selection
bind-key -T copy-mode-vi y send-keys -X copy-pipe-and-cancel "xclip -i -f -selection primary | xclip -i -selection clipboard"
bind-key -T copy-mode-vi r send-keys -X rectangle-toggle

# Enter copy mode with Prefix+[
bind [ copy-mode

# Paste with Prefix+]
bind ] paste-buffer

# ===== WINDOW AND PANE SETTINGS =====

# Enable activity alerts
setw -g monitor-activity on
set -g visual-activity on

# Don't exit tmux when last shell exits
set -g exit-empty off

# Allow automatic renaming of windows
set -g allow-rename on
setw -g automatic-rename on

# Set window title
set -g set-titles on
set -g set-titles-string '#(whoami)@#h:#(pwd)'

# ===== STATUS BAR CONFIGURATION =====

# Status bar general settings
set -g status on
set -g status-interval 5
set -g status-position bottom
set -g status-justify left

# Status bar colors
set -g status-style fg=white,bg=black

# Left side of status bar
set -g status-left-length 40
set -g status-left '#[fg=green,bold]#S #[fg=blue]#(whoami)@#h'

# Right side of status bar
set -g status-right-length 60
set -g status-right '#[fg=yellow]#(uptime | cut -d "," -f 1 | cut -d " " -f 4,5) #[fg=cyan]%Y-%m-%d #[fg=white,bold]%H:%M'

# Window status
setw -g window-status-format ' #I:#W#F '
setw -g window-status-current-format ' #I:#W#F '

# Window status colors
setw -g window-status-style fg=cyan,bg=black
setw -g window-status-current-style fg=black,bg=cyan,bold

# ===== PANE BORDER COLORS =====

set -g pane-border-style fg=black
set -g pane-active-border-style fg=cyan

# ===== MESSAGE COLORS =====

set -g message-style fg=black,bg=cyan
set -g message-command-style fg=black,bg=yellow

# ===== COPY MODE COLORS =====

setw -g mode-style fg=black,bg=cyan

# ===== DEVELOPMENT-SPECIFIC BINDINGS =====

# Quick window layouts for development
bind M-1 select-layout even-horizontal  # Side by side
bind M-2 select-layout even-vertical    # Stack
bind M-3 select-layout main-horizontal  # Main top, others bottom
bind M-4 select-layout main-vertical    # Main left, others right
bind M-5 select-layout tiled           # Tiled

# Create development session layout
bind D new-session -d -s development \; \
    split-window -h \; \
    split-window -v \; \
    select-pane -t 0 \; \
    send-keys 'code .' Enter \; \
    select-pane -t 1 \; \
    send-keys 'claude' Enter \; \
    select-pane -t 2 \; \
    attach-session -t development

# Kill session shortcut
bind X confirm-before -p "Kill session #S? (y/n)" kill-session

# ===== PLUGIN CONFIGURATION =====

# List of plugins (requires TPM - Tmux Plugin Manager)
set -g @plugin 'tmux-plugins/tpm'
set -g @plugin 'tmux-plugins/tmux-sensible'
set -g @plugin 'tmux-plugins/tmux-resurrect'
set -g @plugin 'tmux-plugins/tmux-continuum'
set -g @plugin 'tmux-plugins/tmux-yank'

# Resurrect settings (save/restore sessions)
set -g @resurrect-save-shell-history 'on'
set -g @resurrect-capture-pane-contents 'on'
set -g @resurrect-strategy-vim 'session'
set -g @resurrect-strategy-nvim 'session'

# Continuum settings (automatic save/restore)
set -g @continuum-restore 'on'
set -g @continuum-save-interval '15'

# Yank settings (clipboard integration)
set -g @yank_selection_mouse 'clipboard'

# ===== CUSTOM FUNCTIONS =====

# Quick session switcher
bind s choose-tree -Zs

# Create new session
bind N command-prompt -p "New session name:" "new-session -d -s '%%'"

# Rename session
bind R command-prompt -I "#S" "rename-session '%%'"

# ===== INITIALIZE PLUGIN MANAGER =====

# Initialize TMUX plugin manager (keep this line at the very bottom of tmux.conf)
run '~/.tmux/plugins/tpm/tpm'
